/*! project_3 2018-06-28 */

function Enigma(o){this.form=$(o);for(var t=this.form.find("div.key button"),e=0;e<26;e++)this.installListener($(t[e]));this.resetListener(),this.form.submit(function(t){t.preventDefault();var e=$("form button[clicked=true]").val();$.ajax({url:"post/enigma.php",data:{key:e},method:"POST",success:function(t){if(parse_json(t)){var e=parse_json(t);$(o+" div.rotors").html(e.rotors),$("div.light.light-"+e.light.toLowerCase()).addClass("light-on")}else $(o+" .message").html("<p>Error</p>")},error:function(t,e,r){$(o+" .message").html("<p>Error: "+r+"</p>")}})})}function parse_json(e){try{var t=$.parseJSON(e)}catch(t){throw"JSON parse error: "+e}return t}Enigma.prototype.installListener=function(t){t.mousedown(function(t){t.preventDefault(),$("form button",$(this).parents("form")).removeAttr("clicked"),$("form button[clicked=true]").removeAttr("clicked"),$("div.light.light-on").removeClass("light-on"),$(this).attr("clicked","true"),$($(this).parent()).addClass("pressed")}),t.mouseup(function(t){t.preventDefault(),$($(this).parent()).removeClass("pressed")})},Enigma.prototype.resetListener=function(){var e=this;$(" form div.dialog button").click(function(t){t.preventDefault(),$("form button",$(this).parents("form")).removeAttr("clicked"),$("form button[clicked=true]").removeAttr("clicked"),$("div.light.light-on").removeClass("light-on"),$(this).attr("clicked","true"),e.form.submit()})};