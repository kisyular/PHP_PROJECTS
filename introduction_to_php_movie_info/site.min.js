/*! ajaxnoir 2018-06-26 */

function Login(s){var t=$(s);t.submit(function(e){e.preventDefault(),$.ajax({url:"post/login.php",data:t.serialize(),method:"POST",success:function(e){var t=parse_json(e);t.ok?window.location.assign("./"):$(s+" .message").html("<p>"+t.message+"</p>")},error:function(e,t,a){$(s+" .message").html("<p>Error: "+a+"</p>")}}),console.log("Submitted")})}function MovieInfo(e,t,a){var o=this;this.clickTab="",console.log("MovieInfo: "+t+"/"+a);$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"8db9c7506683bcd0c1d49ec5bd8dd8f1",query:t,year:a},dataType:"text",method:"GET",success:function(e){var t=parse_json(e);if(0<t.total_results){o.present(t.results[0]);var a=$("li > a"),s=a.length;(a=Object.values(a).slice(0,s)).forEach(function(e){$(e).css("opacity","0.3")}),$(a[0]).css("opacity","1.0"),$($(a[0]).parent().children("div")).addClass("show").fadeIn(1e3),a.forEach(function(e){o.installListener(e,a)})}else o.message("<p>No information available</p>")},error:function(e,t,a){console.log("Error"),o.message("<p>Unable to communicate<br>with themoviedb.org</p>")}})}function parse_json(t){try{var e=$.parseJSON(t)}catch(e){throw"JSON parse error: "+t}return e}function Stars(e){for(var t=$(e+" table").find("tr"),a=1;a<t.length;a++)for(var s=$(t.get(a)),o=s.find('input[name="id"]').val(),n=s.find("img"),i=0;i<n.length;i++){var r=$(n.get(i));this.installListener(s,r,o,i+1)}console.log("Stars constructor")}MovieInfo.prototype.message=function(e){$("div.paper").html(e)},MovieInfo.prototype.present=function(e){var t='<ul>\n <li><a href=""><img src="images/info.png"></a>\n<div class="show">\n'+("<p> Title: "+e.original_title+"</p><p>Release Date: "+e.release_date+"</p><p>Vote Average: "+e.vote_average+"</p><p>Vote Count: "+e.vote_count+"</p>")+'</div></li><li><a href=""><img src="images/plot.png"></a>\n<div>\n<p>'+e.overview+"</p>\n</div>";e.poster_path&&(t+='</li><li><a href=""><img src="images/poster.png"></a>\n<div>\n<p><img src='+("http://image.tmdb.org/t/p/w500"+e.poster_path)+">\n</p></p>\n</div></li>\n</ul>");$("div.paper").html(t)},MovieInfo.prototype.installListener=function(e,t){$("li>a");$(e).click(function(e){e.preventDefault(),$("div.show").fadeOut(1e3,function(){$(this).removeClass("show")}),$($(this).parent().children("div")).fadeIn(1e3,function(){$(this).addClass("show")}),t.forEach(function(e){$(e).css("opacity","0.3")}),$(this).css("opacity","1.0")})},Stars.prototype.installListener=function(e,t,a,s){var o=this;t.click(function(){$.ajax({url:"post/stars.php",data:{id:a,rating:s},method:"POST",success:function(e){var t=parse_json(e);t.ok?($("form div.table").html(t.table),$("head").html(t.head),o.message("<p>Successfully updated</p>")):o.message("<p>Update failed</p>")},error:function(e,t,a){o.message("<p>Error: "+a+"</p>")}})})},Stars.prototype.update=function(e,t){for(var a=e.find("img"),s=0;s<a.length;s++){var o=$(a.get(s));s<t?o.attr("src","images/star-green.png"):o.attr("src","images/star-gray.png")}e.find("span.num").text(t+"/10")},Stars.prototype.message=function(e){$("div.message").html(e).show().fadeOut(1e3)};